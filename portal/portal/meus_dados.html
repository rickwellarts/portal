<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Seus dados — CCE 4.0</title>
  <link rel="stylesheet" href="../assets/style.css"/>
</head>
<body class="app-bg">
<section id="sec-usuarios" class="card" hidden>
 <main class="container">
   <link rel="stylesheet" href="/assets/style.css" />
<script type="module">
  import { requireAuth, getSession } from '/assets/auth.js';
  import { renderNavbar, bindNavbar } from '/assets/ui.js';

  (async ()=>{
    const user = await requireAuth();
    document.getElementById('nav-mount').innerHTML = renderNavbar('portal');
    bindNavbar();

    const c = document.getElementById('meus-dados');
    c.innerHTML = `
      <div class="card">
        <h2>Seus dados</h2>
        <p><strong>Nome:</strong> ${user.nome || '-'}</p>
        <p><strong>E-mail:</strong> ${user.email || '-'}</p>
        <p><strong>Login:</strong> ${user.login || '-'}</p>
        <p><strong>Perfil:</strong> ${user.role || 'user'}</p>
      </div>
    `;
  })();
</script>

  </main>

  <script type="module">
    import { requireAuth, getUsers, setUsers, setSessionFromUser } from '../assets/auth.js';
    import { renderNavbar, bindNavbar } from '../assets/ui.js';
    const me = requireAuth();
    document.getElementById('nav-mount').innerHTML = renderNavbar('portal'); bindNavbar();

    const form = document.getElementById('form-user');
    const $ = id => document.getElementById(id);
    $('md-mat').value   = me.matricula||'';
    $('md-login').value = me.login||'';
    $('md-nome').value  = me.nome||'';
    $('md-email').value = me.email||'';

    form.addEventListener('submit', (e)=>{
      e.preventDefault();
      const nome = $('md-nome').value.trim();
      const email= $('md-email').value.trim();
      const senha= $('md-senha').value.trim();
      const arr = getUsers();
      const u = arr.find(x => x.matricula===me.matricula);
      if (!u) return alert('Usuário não encontrado.');
      u.nome = nome; u.email = email;
      if (senha) u.senha = senha;
      setUsers(arr);
      setSessionFromUser(u);
      alert('Dados atualizados.');
      location.href = './index.html';
    });
  </script>
</body>
</html>
